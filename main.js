!function(){"use strict";function e(e,t,r="Save",n="Saving..."){e.textContent=t?n:r}const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_error",inputErrorClass:"modal__input_error"};function r(e,t,r){e.querySelector(`#${t.id}-error`).textContent="",function(e,t){e.classList.remove(t.inputErrorClass)}(t,r)}const n=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?o(t,r):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)},o=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0};const a=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}addPost({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}editAvatarInfo({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}handleLike(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"f1d92113-8da9-4685-b841-8f1b881d6ac0","Content-Type":"application/json"}}),c=document.querySelector(".profile__name"),s=document.querySelector(".profile__description"),i=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__edit-btn"),d=document.querySelector("#edit-profile-modal"),u=d.querySelector(".modal__form"),_=d.querySelector(".modal__close-btn"),m=d.querySelector(".modal__submit-btn"),h=d.querySelector("#profile-name-input"),f=d.querySelector("#profile-description-input"),v=document.querySelector("#edit-avatar-modal"),y=document.querySelector(".profile__avatar-btn"),p=v.querySelector(".modal__form"),b=v.querySelector(".modal__close-btn"),S=v.querySelector(".modal__submit-btn"),q=v.querySelector("#profile-avatar-input"),k=document.querySelector(".profile__post-btn"),L=document.querySelector("#new-post-modal"),E=L.querySelector(".modal__form"),C=L.querySelector(".modal__submit-btn_error"),g=L.querySelector(".modal__close-btn"),U=L.querySelector("#card-image-input"),$=L.querySelector("#card-caption-input"),x=document.querySelector("#card-template").content.querySelector(".card"),D=document.querySelector(".cards__list"),I=document.querySelector("#delete-modal"),A=I.querySelector(".modal__close-btn_delete"),P=I.querySelector(".modal__cancel-btn"),R=I.querySelector(".modal__submit-btn_delete"),T=I.querySelector(".modal__form_delete"),w=document.querySelector("#preview-modal"),B=w.querySelector(".modal__close-btn"),N=w.querySelector(".modal__image"),O=w.querySelector(".modal__caption"),j=[d,L,w,v,I];function J(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&z(e)}}function H(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",J)}function z(e){e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",J)}function M(e){e.target.classList.contains("modal")&&z(e.target)}let F,G;function K(e){const t=x.cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),o=t.querySelector(".card__like-btn"),c=t.querySelector(".card__delete-btn");return r.textContent=e.name,n.src=e.link,n.alt=e.name,o.isLiked=e.isLiked,e.isLiked&&o.classList.add("card__like-btn_active"),o.addEventListener("click",t=>function(e,t){const r=e.target.classList.contains("card__like-btn_active");a.handleLike(t,r).then(t=>{t.isLiked?e.target.classList.add("card__like-btn_active"):e.target.classList.remove("card__like-btn_active")}).catch(console.error)}(t,e._id)),c.addEventListener("click",()=>function(e,t){F=e,G=t,H(I)}(t,e._id)),n.addEventListener("click",()=>{O.textContent=e.name,N.src=e.link,N.alt=e.name,H(w)}),t}var Q;a.getAppInfo().then(([e,t])=>{e.forEach(e=>{const t=K(e);D.append(t)}),c.textContent=t.name,s.textContent=t.about,i.src=t.avatar}).catch(console.error),j.forEach(e=>e.addEventListener("click",M)),B.addEventListener("click",()=>z(w)),l.addEventListener("click",()=>{var e,n;h.value=c.textContent,f.value=s.textContent,e=u,n=t,[h,f].forEach(t=>{r(e,t,n)}),H(d)}),_.addEventListener("click",()=>z(d)),u.addEventListener("submit",function(r){r.preventDefault();const n=r.submitter;e(n,!0),a.editUserInfo({name:h.value,about:f.value}).then(e=>{c.textContent=e.name,s.textContent=e.about,o(m,t),z(d)}).catch(console.error).finally(()=>{e(n,!1)})}),k.addEventListener("click",()=>H(L)),g.addEventListener("click",()=>z(L)),E.addEventListener("submit",function(r){r.preventDefault();const n=r.submitter;e(n,!0),a.addPost({name:$.value,link:U.value}).then(e=>{const r=K(e);D.prepend(r),E.reset(),o(C,t),z(L)}).catch(console.error).finally(()=>{e(n,!1)})}),y.addEventListener("click",()=>H(v)),b.addEventListener("click",()=>z(v)),p.addEventListener("submit",function(r){r.preventDefault();const n=r.submitter;e(n,!0),a.editAvatarInfo({avatar:q.value}).then(e=>{i.src=e.avatar,p.reset(),o(S,t),z(v)}).catch(console.error).finally(()=>{e(n,!1)})}),A.addEventListener("click",()=>z(I)),P.addEventListener("click",()=>z(I)),R.addEventListener("click",()=>z(I)),T.addEventListener("submit",function(t){const r=t.submitter;e(r,!0,"Delete","Deleting..."),t.preventDefault(),a.deleteCard(G).then(()=>{F.remove(),z(I)}).catch(console.error).finally(()=>{e(r,!1,"Delete","Deleting...")})}),Q=t,document.querySelectorAll(Q.formSelector).forEach(e=>{!function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);n(o,a,t),o.forEach(c=>{c.addEventListener("input",function(){((e,t,n)=>{t.validity.valid?r(e,t,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,function(e,t){e.classList.add(t.inputErrorClass)}(t,n)})(e,t,t.validationMessage,n)})(e,c,t),n(o,a,t)})})}(e,Q)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2hCeUMsRUFBQzNJLEVBQWFDLEVBQWNDLEtBQ2hERCxFQUFhYSxTQUFTQyxNQVF6QmhCLEVBQWVDLEVBQWFDLEVBQWNDLEdBekJ2QjBJLEVBQUM1SSxFQUFhQyxFQUFjNEksRUFBYzNJLEtBQ25DRixFQUFZRyxjQUN0QyxJQUFJRixFQUFhRyxZQUVDWixZQUFjcUosRUFacEMsU0FBb0J4SSxFQUFPSCxHQUN6QkcsRUFBTUMsVUFBVWEsSUFBSWpCLEVBQU9KLGdCQUM3QixDQVdFZ0osQ0FBVzdJLEVBQWNDLElBYXZCMEksQ0FDRTVJLEVBQ0FDLEVBQ0FBLEVBQWE4SSxrQkFDYjdJLElBMENBeUksQ0FBbUIzSSxFQUFhQyxFQUFjQyxHQUM5Q08sRUFBa0JDLEVBQVdDLEVBQWVULEVBQzlDLElBRUosQ0FLSThJLENBQWtCaEosRUFBYUUsSSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvaGVscGVycy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBzdWJtaXRCdXR0b25UZXh0KFxuICBidG4sXG4gIGlzTG9hZGluZyxcbiAgZGVmYXVsdFRleHQgPSBcIlNhdmVcIixcbiAgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiXG4pIHtcbiAgaWYgKGlzTG9hZGluZykge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICB9IGVsc2Uge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xuICB9XG59XG4iLCJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2Vycm9yXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfZXJyb3JcIixcbn07XG5cbmZ1bmN0aW9uIGlucHV0RXJyb3IoZXJyb3IsIGNvbmZpZykge1xuICBlcnJvci5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufVxuXG5mdW5jdGlvbiBpbnB1dFZhbGlkKGVycm9yLCBjb25maWcpIHtcbiAgZXJyb3IuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn1cblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICk7XG4gIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gIGlucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBjb25maWcpO1xufTtcblxuZnVuY3Rpb24gaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSB7XG4gIGNvbnN0IGVycm9yTWVzc2FnZUVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICApO1xuICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRWYWxpZChpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG59XG5cbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcbiAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihcbiAgICAgIGZvcm1FbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLFxuICAgICAgY29uZmlnXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICB9XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXQpID0+IHtcbiAgICByZXR1cm4gIWlucHV0LnZhbGlkaXR5LnZhbGlkO1xuICB9KTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCwgY29uZmlnLCBpbnB1dExpc3QpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBjb25maWcpO1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbn07XG5cbmZ1bmN0aW9uIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBjb25maWcpIHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBjb25maWcpO1xuICB9KTtcbn07XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PVxuLy8gMS4gSU1QT1JUUyAmIFNUWUxFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT1cbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IHsgc3VibWl0QnV0dG9uVGV4dCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzLmpzXCI7XG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgc2V0dGluZ3MsXG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHJlc2V0VmFsaWRhdGlvbixcbiAgZGlzYWJsZUJ1dHRvbixcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PVxuLy8gMi4gQVBJIElOSVRJQUxJWkFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PVxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiZjFkOTIxMTMtOGRhOS00Njg1LWI4NDEtOGYxYjg4MWQ2YWMwXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT1cbi8vIDMuIERPTSBFTEVNRU5UU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT1cblxuLy8gUHJvZmlsZVxuY29uc3QgcHJvZmlsZU5hbWVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlRm9ybSA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQ2xvc2VCdG4gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlU3VibWl0QnRuID1cbiAgZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVOYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiXG4pO1xuY29uc3QgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5cbi8vIEF2YXRhclxuY29uc3QgZWRpdEF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGVkaXRBdmF0YXJCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idG5cIik7XG5jb25zdCBlZGl0QXZhdGFyRm9ybSA9IGVkaXRBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdEF2YXRhckNsb3NlQnRuID0gZWRpdEF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGVkaXRBdmF0YXJTdWJtaXRCdG4gPSBlZGl0QXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0blwiKTtcbmNvbnN0IGVkaXRBdmF0YXJJbnB1dCA9IGVkaXRBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtYXZhdGFyLWlucHV0XCIpO1xuXG4vLyBOZXcgUG9zdFxuY29uc3QgbmV3UG9zdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fcG9zdC1idG5cIik7XG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgbmV3UG9zdEZvcm0gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IG5ld1Bvc3RTdWJtaXRCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0bl9lcnJvclwiKTtcbmNvbnN0IG5ld1Bvc3RDbG9zZUJ0biA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBuZXdDYXJkSW1hZ2VJbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XG5jb25zdCBuZXdDYXJkQ2FwdGlvbklucHV0ID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1jYXB0aW9uLWlucHV0XCIpO1xuXG4vLyBDYXJkc1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnRcbiAgLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKVxuICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIik7XG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuXG4vLyBEZWxldGUgTW9kYWxcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtbW9kYWxcIik7XG5jb25zdCBkZWxldGVNb2RhbENsb3NlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ0bl9kZWxldGVcIlxuKTtcbmNvbnN0IGRlbGV0ZU1vZGFsQ2FuY2VsQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FuY2VsLWJ0blwiKTtcbmNvbnN0IGRlbGV0ZU1vZGFsRGVsZXRlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX3N1Ym1pdC1idG5fZGVsZXRlXCJcbik7XG5jb25zdCBkZWxldGVGb3JtID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybV9kZWxldGVcIik7XG5cbi8vIFByZXZpZXcgTW9kYWxcbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbEltYWdlID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2FwdGlvbiA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBPdmVybGF5IE1vZGFsc1xuY29uc3Qgb3ZlcmxheU1vZGFscyA9IFtcbiAgZWRpdFByb2ZpbGVNb2RhbCxcbiAgbmV3UG9zdE1vZGFsLFxuICBwcmV2aWV3TW9kYWwsXG4gIGVkaXRBdmF0YXJNb2RhbCxcbiAgZGVsZXRlTW9kYWwsXG5dO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PVxuLy8gNC4gQVBQIElOSVRJQUxJWkFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PVxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFtjYXJkcywgdXNlcnNdKSA9PiB7XG4gICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xuICAgIH0pO1xuICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSB1c2Vycy5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlcnMuYWJvdXQ7XG4gICAgcHJvZmlsZUF2YXRhci5zcmMgPSB1c2Vycy5hdmF0YXI7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT1cbi8vIDUuIE1PREFMIFVUSUxJVElFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT1cbmZ1bmN0aW9uIGhhbmRsZUVzY2FwZUtleShldmVudCkge1xuICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3Blbk1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9pcy1vcGVuZWRcIik7XG4gICAgaWYgKG9wZW5Nb2RhbCkgY2xvc2VNb2RhbChvcGVuTW9kYWwpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGVLZXkpO1xufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZUtleSk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlT25PdmVybGF5KGV2dCkge1xuICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbFwiKSkgY2xvc2VNb2RhbChldnQudGFyZ2V0KTtcbn1cblxuLy8gQXBwbHkgb3ZlcmxheSBjbG9zZSBmb3IgYWxsIG1vZGFsc1xub3ZlcmxheU1vZGFscy5mb3JFYWNoKChtb2RhbCkgPT5cbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNsb3NlT25PdmVybGF5KVxuKTtcblxucHJldmlld01vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwocHJldmlld01vZGFsKSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09XG4vLyA2LiBQUk9GSUxFIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT1cbmVkaXRQcm9maWxlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudDtcbiAgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihlZGl0UHJvZmlsZUZvcm0sIHNldHRpbmdzLCBbXG4gICAgZWRpdFByb2ZpbGVOYW1lSW5wdXQsXG4gICAgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LFxuICBdKTtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbClcbik7XG5cbmVkaXRQcm9maWxlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRQcm9maWxlU3VibWl0KTtcblxuZnVuY3Rpb24gaGFuZGxlRWRpdFByb2ZpbGVTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG4gIHN1Ym1pdEJ1dHRvblRleHQoc3VibWl0QnRuLCB0cnVlKTtcblxuICBhcGlcbiAgICAuZWRpdFVzZXJJbmZvKHtcbiAgICAgIG5hbWU6IGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlLFxuICAgICAgYWJvdXQ6IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuICAgICAgZGlzYWJsZUJ1dHRvbihlZGl0UHJvZmlsZVN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHN1Ym1pdEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09XG4vLyA3LiBORVcgUE9TVCBGVU5DVElPTlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09XG5uZXdQb3N0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKSk7XG5uZXdQb3N0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKSk7XG5uZXdQb3N0Rm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZU5ld1Bvc3RTdWJtaXQpO1xuXG5mdW5jdGlvbiBoYW5kbGVOZXdQb3N0U3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc3VibWl0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xuXG4gIGFwaVxuICAgIC5hZGRQb3N0KHtcbiAgICAgIG5hbWU6IG5ld0NhcmRDYXB0aW9uSW5wdXQudmFsdWUsXG4gICAgICBsaW5rOiBuZXdDYXJkSW1hZ2VJbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBjb25zdCBuZXdDYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGRhdGEpO1xuICAgICAgY2FyZHNMaXN0LnByZXBlbmQobmV3Q2FyZEVsZW1lbnQpO1xuICAgICAgbmV3UG9zdEZvcm0ucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdXR0b24obmV3UG9zdFN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc3VibWl0QnV0dG9uVGV4dChzdWJtaXRCdG4sIGZhbHNlKTtcbiAgICB9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT1cbi8vIDguIEFWQVRBUiBGVU5DVElPTlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09XG5lZGl0QXZhdGFyQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBvcGVuTW9kYWwoZWRpdEF2YXRhck1vZGFsKSk7XG5lZGl0QXZhdGFyQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoZWRpdEF2YXRhck1vZGFsKSk7XG5lZGl0QXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG4gIHN1Ym1pdEJ1dHRvblRleHQoc3VibWl0QnRuLCB0cnVlKTtcbiAgYXBpXG4gICAgLmVkaXRBdmF0YXJJbmZvKHsgYXZhdGFyOiBlZGl0QXZhdGFySW5wdXQudmFsdWUgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZUF2YXRhci5zcmMgPSBkYXRhLmF2YXRhcjtcbiAgICAgIGVkaXRBdmF0YXJGb3JtLnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGVkaXRBdmF0YXJTdWJtaXRCdG4sIHNldHRpbmdzKTtcbiAgICAgIGNsb3NlTW9kYWwoZWRpdEF2YXRhck1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHN1Ym1pdEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09XG4vLyA5LiBDQVJEIENSRUFUSU9OICYgSU5URVJBQ1RJT05TXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PVxubGV0IHNlbGVjdGVkQ2FyZCwgc2VsZWN0ZWRDYXJkSWQ7XG5cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICBjb25zdCBjYXJkVGl0bGVFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xuXG4gIGNhcmRUaXRsZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICBjYXJkSW1hZ2VFbC5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcblxuICAvLyBMaWtlIHRvZ2dsZVxuICBjYXJkTGlrZUJ0bi5pc0xpa2VkID0gZGF0YS5pc0xpa2VkO1xuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZUxpa2UoZXZ0LCBpZCkge1xuICAgIGNvbnN0IGlzTGlrZWQgPSBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcbiAgICBhcGlcbiAgICAgIC5oYW5kbGVMaWtlKGlkLCBpc0xpa2VkKVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgaWYgKGRhdGEuaXNMaWtlZCkge1xuICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIik7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gIH1cbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IGhhbmRsZUxpa2UoZXZ0LCBkYXRhLl9pZCkpO1xuXG4gIC8vIERlbGV0ZSBNb2RhbCBQb3B1cFxuICBmdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBjYXJkSWQpIHtcbiAgICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgICBzZWxlY3RlZENhcmRJZCA9IGNhcmRJZDtcbiAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xuICB9XG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YS5faWQpXG4gICk7XG5cbiAgLy8gUHJldmlldyBpbWFnZVxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHByZXZpZXdNb2RhbENhcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld01vZGFsSW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdNb2RhbEltYWdlLmFsdCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PVxuLy8gMTAuIERFTEVURSBNT0RBTFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT1cbmRlbGV0ZU1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpKTtcbmRlbGV0ZU1vZGFsQ2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKSk7XG5kZWxldGVNb2RhbERlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChkZWxldGVNb2RhbCkpO1xuXG4vLyBEZWxldGUgY2FyZFxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KGV2dCkge1xuICBjb25zdCBkZWxldGVCdG4gPSBldnQuc3VibWl0dGVyO1xuICBzdWJtaXRCdXR0b25UZXh0KGRlbGV0ZUJ0biwgdHJ1ZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGFwaVxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc3VibWl0QnV0dG9uVGV4dChkZWxldGVCdG4sIGZhbHNlLCBcIkRlbGV0ZVwiLCBcIkRlbGV0aW5nLi4uXCIpO1xuICAgIH0pO1xufVxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09XG4vLyAxMS4gVkFMSURBVElPTiBFTkFCTEVcbi8vID09PT09PT09PT09PT09PT09PT09PT09XG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICB9XG5cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGFkZFBvc3QoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0QXZhdGFySW5mbyh7IGF2YXRhciB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYXZhdGFyLFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBoYW5kbGVMaWtlKGlkLCBpc0xpa2VkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbInN1Ym1pdEJ1dHRvblRleHQiLCJidG4iLCJpc0xvYWRpbmciLCJkZWZhdWx0VGV4dCIsImxvYWRpbmdUZXh0IiwidGV4dENvbnRlbnQiLCJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiY29uZmlnIiwicXVlcnlTZWxlY3RvciIsImlkIiwiZXJyb3IiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJpbnB1dFZhbGlkIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50Iiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsImFwaSIsImNvbnN0cnVjdG9yIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsIl9jaGVja1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEFwcEluZm8iLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsImFkZFBvc3QiLCJuYW1lIiwibGluayIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdFVzZXJJbmZvIiwiYWJvdXQiLCJlZGl0QXZhdGFySW5mbyIsImF2YXRhciIsImRlbGV0ZUNhcmQiLCJoYW5kbGVMaWtlIiwiaXNMaWtlZCIsImF1dGhvcml6YXRpb24iLCJwcm9maWxlTmFtZUVsIiwiZG9jdW1lbnQiLCJwcm9maWxlRGVzY3JpcHRpb25FbCIsInByb2ZpbGVBdmF0YXIiLCJlZGl0UHJvZmlsZUJ0biIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0UHJvZmlsZUZvcm0iLCJlZGl0UHJvZmlsZUNsb3NlQnRuIiwiZWRpdFByb2ZpbGVTdWJtaXRCdG4iLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImVkaXRBdmF0YXJNb2RhbCIsImVkaXRBdmF0YXJCdG4iLCJlZGl0QXZhdGFyRm9ybSIsImVkaXRBdmF0YXJDbG9zZUJ0biIsImVkaXRBdmF0YXJTdWJtaXRCdG4iLCJlZGl0QXZhdGFySW5wdXQiLCJuZXdQb3N0QnRuIiwibmV3UG9zdE1vZGFsIiwibmV3UG9zdEZvcm0iLCJuZXdQb3N0U3VibWl0QnRuIiwibmV3UG9zdENsb3NlQnRuIiwibmV3Q2FyZEltYWdlSW5wdXQiLCJuZXdDYXJkQ2FwdGlvbklucHV0IiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImNhcmRzTGlzdCIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlTW9kYWxDbG9zZUJ0biIsImRlbGV0ZU1vZGFsQ2FuY2VsQnRuIiwiZGVsZXRlTW9kYWxEZWxldGVCdG4iLCJkZWxldGVGb3JtIiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsQ2xvc2VCdG4iLCJwcmV2aWV3TW9kYWxJbWFnZSIsInByZXZpZXdNb2RhbENhcHRpb24iLCJvdmVybGF5TW9kYWxzIiwiaGFuZGxlRXNjYXBlS2V5IiwiZXZlbnQiLCJrZXkiLCJvcGVuTW9kYWwiLCJjbG9zZU1vZGFsIiwibW9kYWwiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNsb3NlT25PdmVybGF5IiwiZXZ0IiwidGFyZ2V0IiwiY29udGFpbnMiLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImdldENhcmRFbGVtZW50IiwiZGF0YSIsImNhcmRFbGVtZW50IiwiY2xvbmVOb2RlIiwiY2FyZFRpdGxlRWwiLCJjYXJkSW1hZ2VFbCIsImNhcmRMaWtlQnRuIiwiY2FyZERlbGV0ZUJ0biIsInNyYyIsImFsdCIsImNhdGNoIiwiY29uc29sZSIsIl9pZCIsImNhcmRJZCIsImhhbmRsZURlbGV0ZUNhcmQiLCJjYXJkcyIsInVzZXJzIiwiZm9yRWFjaCIsIml0ZW0iLCJhcHBlbmQiLCJyZXNldFZhbGlkYXRpb24iLCJ2YWx1ZSIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0QnRuIiwic3VibWl0dGVyIiwiZmluYWxseSIsIm5ld0NhcmRFbGVtZW50IiwicHJlcGVuZCIsInJlc2V0IiwiZGVsZXRlQnRuIiwicXVlcnlTZWxlY3RvckFsbCIsIkFycmF5IiwiZnJvbSIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiaW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwic2V0RXZlbnRMaXN0ZW5lcnMiXSwic291cmNlUm9vdCI6IiJ9